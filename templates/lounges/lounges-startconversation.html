{% extends "layout/template-base.html" %}

{% block title %}MSX Center - Conversation lounges{% endblock %}

{% if errors %}
{% set form_status = 'disabled' %}
{% else: %}
{% set form_status = '' %}
{% endif %}

{% block extracss %}
<link rel="stylesheet" href="/static/css/quill.snow.css">
{% endblock %}

{% block content %}
<div class="row">
	<div class="col-lg-offset-2 col-md-8 col-md-offset-2">
		<div>
			<h1>Start new conversation</h1>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2">
		<div class="panel panel-{{ lounge.color_class }}">
			<div class="panel-heading">
				<h3 class="panel-title">Posting on the <strong>{{ lounge.name_en }}</strong> lounge</h3>
			</div>
		</div>
		<form>
			<div class="form-group lead">
				<label class="control-label">Conversation topics</label>
				<p>{{ lounge.desc_en }}</p>
			</div>

			{# Display posting permissions #}
			{% include '/lounges/include-lounge-thread-permissions.html' %}

			{# Display messages indicating why the user can't post, or the Quill editor input if he's allowed #}
			{% include '/lounges/include-editor-new-conversation.html' %}

		</form>
	</div>
</div>
{% endblock %}
{% block extrajs %}
{% if not errors %}
<script type="text/javascript" src="/static/js/quill.min.js"></script>
<script type="text/javascript">

	// Initialize MediumEditor
	var toolbarOptions = [
		[{ 'header': [1, 2, 3, false] }],
		[{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown
		['bold', 'italic', 'underline', 'strike'],        // toggled buttons
		[{ 'color': [] },],          // dropdown with defaults from theme
		['link', 'image', 'video', 'blockquote', 'code-block'],
		[{ 'list': 'ordered'}, { 'list': 'bullet' }],
		[{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent

	];
	var quill = new Quill('#quillEditor' , {
		modules : {
			toolbar: toolbarOptions
		},
		theme: 'snow'
	});

    // Attach event to button
    $("#submitButton").click(function (e) {
		e.preventDefault();
        console.log("Button pressed");

        $.ajax({
            method: "POST",
            url: "{{ url_for('page_lounge_post', lounge_id=lounge.id) }}",
            processData: true,
			dataType: 'json',
            data: {
                lounge_id: {{ lounge.id }},
				post_as: $('#field_post_as').val(),
				title: $('#field_conversation_title').val(),
                message: quill.root.innerHTML
            }
        })
        .done(function(result) {
			console.log('Redirecting to ' + result.url)
			window.location = result.url;
        });
		quill.enable(false);
		$("#submitButton").prop("disabled", true);
		$("#quillEditor").prop("disabled", true);
		$("#field_conversation_title").prop("disabled", true);
    });
</script>
{% endif %}
<script type="text/javascript">
	// Initialize popovers
	$(function () {
		$('[data-toggle="popover"]').popover({container: 'body', placement: 'top', trigger: 'hover'})
	});
</script>
{% endblock %}
